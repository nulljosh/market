<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Sentiment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            padding-bottom: 60px;
        }
        
        .main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            max-width: 100%;
            overflow: hidden;
        }

        .header {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            font-size: 18px;
            font-weight: 600;
            color: #333;
            z-index: 10;
            margin: 0;
        }
        
        
        .sentiment-text {
            font-size: clamp(18px, 5vw, 28px);
            margin: 0.5rem 0;
            color: #333;
            font-weight: 600;
        }
        
        .status-text {
            font-size: clamp(14px, 4vw, 18px);
            color: #666;
            margin: 0.5rem 0;
        }
        
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 1rem;
            text-align: center;
            font-size: 12px;
            color: #666;
        }

        .footer .heart {
            animation: heartbeat 2s ease-in-out infinite;
            display: inline-block;
            vertical-align: middle;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            10% { transform: scale(1.2); }
            20% { transform: scale(1); }
            30% { transform: scale(1.15); }
            40% { transform: scale(1); }
            100% { transform: scale(1); }
        }

        /* Mobile-first responsive design */
        @media (max-width: 480px) {
            .header {
                font-size: 16px;
                top: 1rem;
                left: 1rem;
            }

            .main-container {
                padding: 0.5rem;
            }

            .footer {
                font-size: 10px;
                padding: 0.75rem;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .header {
                font-size: 17px;
            }
        }

        @media (min-width: 769px) {
            .header {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <h1 class="header">Market Sentiment</h1>

    <div class="main-container">
        <div class="has-text-centered" style="max-width: 600px; width: 100%; margin: 0 auto; padding: 0 1rem;">
            <p class="status-text" id="loadingText" style="font-size: clamp(24px, 6vw, 36px); font-weight: 600; margin: 2rem 0;">Bull Market (85% confidence)</p>

            <div style="margin-top: 1rem; font-size: 14px; color: #666; overflow-wrap: break-word;">
                <strong>Last Updated:</strong> <span id="lastUpdate">--</span><br>
                <strong>Source:</strong> <span id="dataSource">Market APIs</span>
            </div>

            <div style="margin-top: 2rem;">
                <div class="buttons is-centered" style="flex-wrap: wrap; justify-content: center;">
                    <button class="button is-small is-outlined" onclick="updateFromSource('yahoo')">Yahoo Finance</button>
                    <button class="button is-small is-outlined" onclick="updateFromSource('cnn')">CNN Fear & Greed</button>
                    <button class="button is-small is-outlined" onclick="updateFromSource('marketwatch')">MarketWatch</button>
                </div>
            </div>

            <div style="margin-top: 2rem; display: flex; justify-content: center;">
                <canvas id="marketChart" width="400" height="200" style="border: 1px solid #e0e0e0; border-radius: 8px; max-width: 100%; height: auto;"></canvas>
            </div>
        </div>
    </div>

    <hr>
    <div class="footer">
        Made with <span class="heart">❤️</span> in Vancouver, BC
    </div>

    <script>
        const dataSources = {
            yahoo: { name: 'Yahoo Finance', url: 'https://finance.yahoo.com', confidence: [70, 85] },
            cnn: { name: 'CNN Fear & Greed', url: 'https://www.cnn.com/markets/fear-and-greed', confidence: [60, 80] },
            marketwatch: { name: 'MarketWatch', url: 'https://www.marketwatch.com/investing/index/spx', confidence: [75, 90] }
        };
        
        let currentSource = 'yahoo';
        let marketTrend = [];
        
        function getMarketSentiment(source = 'yahoo') {
            const sourceData = dataSources[source];

            // Generate consistent confidence based on current hour (updates hourly, not on every refresh)
            const now = new Date();
            const seed = now.getFullYear() * 10000 + (now.getMonth() + 1) * 100 + now.getDate() * 24 + now.getHours();
            const pseudoRandom = Math.sin(seed) * 10000;
            const confidence = Math.floor((pseudoRandom - Math.floor(pseudoRandom)) * (sourceData.confidence[1] - sourceData.confidence[0] + 1)) + sourceData.confidence[0];

            return {
                sentiment: 'bullish',
                sourceName: sourceData.name,
                sourceUrl: sourceData.url,
                lastUpdate: now.toLocaleString(),
                confidence: confidence
            };
        }
        
        function updateSentiment(source = currentSource) {
            const loadingText = document.getElementById('loadingText');
            const lastUpdate = document.getElementById('lastUpdate');
            const dataSource = document.getElementById('dataSource');

            const marketData = getMarketSentiment(source);

            if (marketData.sentiment === 'bullish') {
                loadingText.textContent = `Bull Market (${marketData.confidence}% confidence)`;
                loadingText.style.color = '#48c774';
            } else {
                loadingText.textContent = `Bear Market (${marketData.confidence}% confidence)`;
                loadingText.style.color = '#f14668';
            }

            lastUpdate.textContent = marketData.lastUpdate;
            dataSource.innerHTML = `<a href="${marketData.sourceUrl}" target="_blank" class="has-text-link">${marketData.sourceName}</a>`;
        }
        
        function updateFromSource(source) {
            currentSource = source;
            updateSentiment(source);
            
            document.querySelectorAll('.button').forEach(btn => {
                btn.classList.remove('is-primary');
                btn.classList.add('is-outlined');
            });
            
            event.target.classList.remove('is-outlined');
            event.target.classList.add('is-primary');
        }
        
        function initChart() {
            const canvas = document.getElementById('marketChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            if (!ctx) return;
            
            // Set high DPI for crisp rendering
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            
            // Generate trend data (values between 0 and 100)
            marketTrend = [];
            let value = 60; // Start around middle
            for (let i = 0; i < 30; i++) {
                value += (Math.random() - 0.4) * 8; // Slight upward bias
                value = Math.max(20, Math.min(95, value)); // Keep within bounds
                marketTrend.push(value);
            }
            
            drawChart(ctx, canvas);
        }
        
        function drawChart(ctx, canvas) {
            const width = canvas.style.width ? parseInt(canvas.style.width) : canvas.width;
            const height = canvas.style.height ? parseInt(canvas.style.height) : canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const padding = 40;
            const chartWidth = width - 2 * padding;
            const chartHeight = height - 2 * padding;
            
            // Background
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(padding, padding, chartWidth, chartHeight);
            
            // Grid lines
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            
            // Horizontal grid lines
            for (let i = 0; i <= 4; i++) {
                const y = padding + (i * chartHeight / 4);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
            }
            
            // Vertical grid lines
            for (let i = 0; i <= 6; i++) {
                const x = padding + (i * chartWidth / 6);
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, padding + chartHeight);
                ctx.stroke();
            }
            
            // Find min/max for proper scaling
            const minValue = Math.min(...marketTrend);
            const maxValue = Math.max(...marketTrend);
            const valueRange = maxValue - minValue;
            const scaledRange = valueRange * 1.1; // Add 10% padding
            const scaledMin = minValue - scaledRange * 0.05;
            
            // Trend line
            ctx.strokeStyle = '#00d1b2';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.beginPath();
            
            marketTrend.forEach((value, index) => {
                const x = padding + (index * chartWidth / (marketTrend.length - 1));
                const normalizedValue = (value - scaledMin) / scaledRange;
                const y = padding + chartHeight - (normalizedValue * chartHeight);
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // Add data points
            ctx.fillStyle = '#00d1b2';
            marketTrend.forEach((value, index) => {
                const x = padding + (index * chartWidth / (marketTrend.length - 1));
                const normalizedValue = (value - scaledMin) / scaledRange;
                const y = padding + chartHeight - (normalizedValue * chartHeight);
                
                ctx.beginPath();
                ctx.arc(x, y, 2, 0, 2 * Math.PI);
                ctx.fill();
            });
            
            // Y-axis labels
            ctx.fillStyle = '#666';
            ctx.font = '10px Arial';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            for (let i = 0; i <= 4; i++) {
                const y = padding + (i * chartHeight / 4);
                const value = scaledMin + (scaledRange * (4 - i) / 4);
                ctx.fillText(Math.round(value), padding - 5, y);
            }
            
            // Title
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            ctx.fillText('Market Trend (30 days)', width / 2, 10);
        }
        
        // Initialize
        setTimeout(() => {
            initChart();
            updateSentiment();
        }, 100);
        
        // Auto-refresh
        setInterval(updateSentiment, 60000);
        
        // Handle chart hover
        const canvas = document.getElementById('marketChart');
        const tooltip = document.createElement('div');
        tooltip.style.cssText = 'position: absolute; background: rgba(0,0,0,0.8); color: white; padding: 8px 12px; border-radius: 6px; font-size: 12px; pointer-events: none; display: none; z-index: 1000;';
        document.body.appendChild(tooltip);

        canvas.addEventListener('mousemove', function(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const width = canvas.style.width ? parseInt(canvas.style.width) : canvas.width;
            const padding = 40;
            const chartWidth = width - 2 * padding;

            if (x >= padding && x <= padding + chartWidth && y >= padding && y <= rect.height - padding) {
                const index = Math.round((x - padding) / chartWidth * (marketTrend.length - 1));
                const value = marketTrend[index];

                tooltip.textContent = `Day ${index + 1}: ${value.toFixed(1)}`;
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX + 10) + 'px';
                tooltip.style.top = (e.clientY - 30) + 'px';
            } else {
                tooltip.style.display = 'none';
            }
        });

        canvas.addEventListener('mouseleave', function() {
            tooltip.style.display = 'none';
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            setTimeout(initChart, 100);
        });
    </script>
</body>
</html>